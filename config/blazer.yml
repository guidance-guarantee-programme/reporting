# see https://github.com/ankane/blazer for more info

data_sources:
  welsh_language_appointments:
    url: <%= ENV['WELSH_LANGUAGE_APPOINTMENTS_DATABASE_URL'] %>

    cache:
      mode: all
      expires_in: 60 # min

  pension_guidance:
    url: <%= ENV['PENSION_GUIDANCE_DATABASE_URL'] %>

    cache:
      mode: all
      expires_in: 60 # min

  tesco:
    url: <%= ENV['TESCO_DATABASE_URL'] %>

    cache:
      mode: all
      expires_in: 60 # min

  tap:
    url: <%= ENV['TAP_DATABASE_URL'] %>

    smart_columns:
      status: { 0: "pending", 1: "complete", 2: "no_show", 3: "incomplete", 4: "ineligible_age", 5: "ineligible_pension_type", 6 "cancelled_by_customer", 7: "cancelled_by_pension_wise", 8: "cancelled_by_sms" }

    cache:
      mode: all
      expires_in: 60 # min

  planner:
    url: <%= ENV['PLANNER_DATABASE_URL'] %>

    smart_columns:
      status: { 0: "pending", 1: "complete", 2: "no_show", 3: "ineligible_age", 4: "ineligible_pension_type", 5: "cancelled_by_customer", 6: "cancelled_by_pension_wise", 7: "cancelled_by_sms", 8: "incomplete_other" }

    inherit_smart_settings:
    - locator
    - reporting

    cache:
      mode: all
      expires_in: 60 # min

  locator:
    url: <%= ENV['LOCATOR_DATABASE_URL'] %>


    smart_columns:
      location_id: "SELECT uid, title FROM locations WHERE state = 'current' AND uid IN {value}"
      booking_location_id:
        SELECT uid, title as booking_location
        FROM locations
        WHERE state = 'current'
        AND (booking_location_uid IS NULL OR booking_location_uid = '')
        AND uid IN {value}
      delivery_partner_id:
        SELECT l.uid, l.organisation
        FROM locations l
        WHERE l.state = 'current'

    cache:
      mode: all
      expires_in: 60 # min

  reporting:
    url: <%= ENV['DATABASE_URL'] %>

    smart_columns:
      answered_daily_calls:
        SELECT location_uid || DATE(called_at), count(1)
        FROM twilio_calls tc
        WHERE outcome = 'forwarded'
        GROUP BY location_uid || DATE(called_at)

      total_daily_calls:
        SELECT location_uid || DATE(called_at), count(1)
        FROM twilio_calls tc
        GROUP BY location_uid || DATE(called_at)

#  main:
#    url: <%= ENV["BLAZER_DATABASE_URL"] %>
#
#    # statement timeout, in seconds
#    # none by default
#    # timeout: 15
#
#    # caching settings
#    # can greatly improve speed
#    # off by default
#    # cache:
#    #   mode: slow # or all
#    #   expires_in: 60 # min
#    #   slow_threshold: 15 # sec, only used in slow mode
#
#    # wrap queries in a transaction for safety
#    # not necessary if you use a read-only user
#    # true by default
#    # use_transaction: false
#
#    smart_variables:
#      # zone_id: "SELECT id, name FROM zones ORDER BY name ASC"
#      # period: ["day", "week", "month"]
#      # status: {0: "Active", 1: "Archived"}
#
#    linked_columns:
#      # user_id: "/admin/users/{value}"
#
#    smart_columns:
#      # user_id: "SELECT id, name FROM users WHERE id IN {value}"

# create audits
audit: true

# change the time zone
# time_zone: "Pacific Time (US & Canada)"

# class name of the user model
# user_class: User

# method name for the user model
# user_name: name

# optional auth method to use as a before_action (default: nil)
# before_action: :authenticate!

# email to send checks from
# from_email: blazer@example.org

check_schedules:
  - "1 day"
  - "1 hour"
  - "5 minutes"
